name: Fuzz Testing

on:
  schedule:
    - cron: '0 0 * * *'  # Midnight, daily.

env:
  CARGO_TERM_COLOR: always

jobs:
  manifest_parse:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Install Toolchain
      uses: actions-rs/toolchain@v1
      with:
        toolchain: nightly
    - name: Install `cargo fuzz`
      run: cargo install cargo-fuzz

    - name: Fuzz `manifest_parse`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          manifest_parse \
          -- \
          -max_total_time=600

  ## Autogenerated targets below. Hand-coded targets should go above
  ## this line.

  # NOTE: Autogenerated by util/new_protocol_target.py ci firmware_version
  firmware_version:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Install Toolchain
      uses: actions-rs/toolchain@v1
      with:
        toolchain: nightly
    - name: Install `cargo fuzz`
      run: cargo install cargo-fuzz

    - name: Fuzz `firmware_version_request_from_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          firmware_version_request_from_wire \
          -- \
          -max_total_time=300
    - name: Fuzz `firmware_version_response_from_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          firmware_version_response_from_wire \
          -- \
          -max_total_time=180
    - name: Fuzz `firmware_version_request_to_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          firmware_version_request_to_wire \
          -- \
          -max_total_time=300
    - name: Fuzz `firmware_version_response_to_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          firmware_version_response_to_wire \
          -- \
          -max_total_time=180

  # NOTE: Autogenerated by util/new_protocol_target.py ci device_capabilities
  device_capabilities:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Install Toolchain
      uses: actions-rs/toolchain@v1
      with:
        toolchain: nightly
    - name: Install `cargo fuzz`
      run: cargo install cargo-fuzz

    - name: Fuzz `device_capabilities_request_from_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_capabilities_request_from_wire \
          -- \
          -max_total_time=300
    - name: Fuzz `device_capabilities_response_from_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_capabilities_response_from_wire \
          -- \
          -max_total_time=180
    - name: Fuzz `device_capabilities_request_to_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_capabilities_request_to_wire \
          -- \
          -max_total_time=300
    - name: Fuzz `device_capabilities_response_to_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_capabilities_response_to_wire \
          -- \
          -max_total_time=180

  # NOTE: Autogenerated by util/new_protocol_target.py ci device_id
  device_id:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Install Toolchain
      uses: actions-rs/toolchain@v1
      with:
        toolchain: nightly
    - name: Install `cargo fuzz`
      run: cargo install cargo-fuzz

    - name: Fuzz `device_id_request_from_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_id_request_from_wire \
          -- \
          -max_total_time=300
    - name: Fuzz `device_id_response_from_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_id_response_from_wire \
          -- \
          -max_total_time=180
    - name: Fuzz `device_id_request_to_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_id_request_to_wire \
          -- \
          -max_total_time=300
    - name: Fuzz `device_id_response_to_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_id_response_to_wire \
          -- \
          -max_total_time=180

  # NOTE: Autogenerated by util/new_protocol_target.py ci device_info
  device_info:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Install Toolchain
      uses: actions-rs/toolchain@v1
      with:
        toolchain: nightly
    - name: Install `cargo fuzz`
      run: cargo install cargo-fuzz

    - name: Fuzz `device_info_request_from_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_info_request_from_wire \
          -- \
          -max_total_time=300
    - name: Fuzz `device_info_response_from_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_info_response_from_wire \
          -- \
          -max_total_time=180
    - name: Fuzz `device_info_request_to_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_info_request_to_wire \
          -- \
          -max_total_time=300
    - name: Fuzz `device_info_response_to_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_info_response_to_wire \
          -- \
          -max_total_time=180

  # NOTE: Autogenerated by util/new_protocol_target.py ci device_uptime
  device_uptime:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Install Toolchain
      uses: actions-rs/toolchain@v1
      with:
        toolchain: nightly
    - name: Install `cargo fuzz`
      run: cargo install cargo-fuzz

    - name: Fuzz `device_uptime_request_from_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_uptime_request_from_wire \
          -- \
          -max_total_time=300
    - name: Fuzz `device_uptime_response_from_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_uptime_response_from_wire \
          -- \
          -max_total_time=180
    - name: Fuzz `device_uptime_request_to_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_uptime_request_to_wire \
          -- \
          -max_total_time=300
    - name: Fuzz `device_uptime_response_to_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          device_uptime_response_to_wire \
          -- \
          -max_total_time=180

  # NOTE: Autogenerated by util/new_protocol_target.py ci request_counter
  request_counter:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Install Toolchain
      uses: actions-rs/toolchain@v1
      with:
        toolchain: nightly
    - name: Install `cargo fuzz`
      run: cargo install cargo-fuzz

    - name: Fuzz `request_counter_request_from_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          request_counter_request_from_wire \
          -- \
          -max_total_time=300
    - name: Fuzz `request_counter_response_from_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          request_counter_response_from_wire \
          -- \
          -max_total_time=180
    - name: Fuzz `request_counter_request_to_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          request_counter_request_to_wire \
          -- \
          -max_total_time=300
    - name: Fuzz `request_counter_response_to_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          request_counter_response_to_wire \
          -- \
          -max_total_time=180

  # NOTE: Autogenerated by util/new_protocol_target.py ci reset_counter
  reset_counter:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Install Toolchain
      uses: actions-rs/toolchain@v1
      with:
        toolchain: nightly
    - name: Install `cargo fuzz`
      run: cargo install cargo-fuzz

    - name: Fuzz `reset_counter_request_from_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          reset_counter_request_from_wire \
          -- \
          -max_total_time=300
    - name: Fuzz `reset_counter_response_from_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          reset_counter_response_from_wire \
          -- \
          -max_total_time=180
    - name: Fuzz `reset_counter_request_to_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          reset_counter_request_to_wire \
          -- \
          -max_total_time=300
    - name: Fuzz `reset_counter_response_to_wire`
      run: |
        cargo +nightly fuzz run \
          --release \
          --sanitizer address \
          reset_counter_response_to_wire \
          -- \
          -max_total_time=180

